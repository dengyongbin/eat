<!DOCTYPE html>
<html>
<head lang="zh-CN">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>吃饭啦</title>
    <link href="eat.ico" rel="icon">
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="eat.css">
</head>
<body>
<div class="container">
    <div id="main" class="row">
        <div  class="col-xs-6 col-md-9">
            <div style="margin-right: 15px;">
                <div id="select" class="row hide">

                </div>
                <div id="person" class="row">
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://striker.teambition.net/thumbnail/110m09e501e71747f2c65cd961d7dcfb001f/w/200/h/200" class="img-rounded">
                            <h5>孙炫</h5>
                            <button class="btn btn-primary" id="sunxuan">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://striker.teambition.com/thumbnail/9a/a3/c621215af5d87ee26337a74e7468.png/w/200/h/200" class="img-rounded">
                            <h5>邓皆斌</h5>
                            <button class="btn btn-primary" id="dengjiebin">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://striker.teambition.net/thumbnail/1103401c9d79094440ab688549ae418ee1a1/w/200/h/200" class="img-rounded">
                            <h5>邓拥斌</h5>
                            <button class="btn btn-primary" id="dengyongbin">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://mailimg.teambition.com/logos/1.png" class="img-rounded">
                            <h5>柯现</h5>
                            <button class="btn btn-primary" id="kexian">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://striker.teambition.com/thumbnail/6a/1d/201276da0789c3fdcdaba170e905.png/w/200/h/200" class="img-rounded">
                            <h5>马石驭</h5>
                            <button class="btn btn-primary" id="mashiyu">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://striker.teambition.net/thumbnail/110mce5324b111669530807c8861492b2f53/w/200/h/200" class="img-rounded">
                            <h5>李嘉帅</h5>
                            <button class="btn btn-primary" id="lijiashuai">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://striker.teambition.net/thumbnail/110f8c300b0c5cd3a3fb5f6d31d4f7124c18/w/200/h/200" class="img-rounded">
                            <h5>刘伟</h5>
                            <button class="btn btn-primary" id="liuwei">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://dn-st.qbox.me/user_default_avatars/4.png" class="img-rounded">
                            <h5>阮云冬</h5>
                            <button class="btn btn-primary" id="ruanyundong">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://striker.teambition.net/thumbnail/110cb5151f38203b7cd91f1edf996dfcfc0d/w/200/h/200" class="img-rounded">
                            <h5>胡小静</h5>
                            <button class="btn btn-primary" id="huxiaojing">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://striker.teambition.net/thumbnail/110na9e7e16fcdda3a763fc501f55d2e310d/w/200/h/200" class="img-rounded">
                            <h5>郑晓庆</h5>
                            <button class="btn btn-primary" id="zhengxiaoqing">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://striker.teambition.net/thumbnail/110s68895f828ecfb19dcdc2297d5e6edbb2/w/200/h/200" class="img-rounded">
                            <h5>张笑佳</h5>
                            <button class="btn btn-primary" id="zhangxiaojia">报名</button>
                        </div>
                    </div>
                    
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://static.bearychat.com/FigA2NER4AlfmIQlxmfRfAesg43x"
                                 class="img-rounded">
                            <h5>条形马</h5>
                            <button class="btn btn-primary" id="tiaoxingma">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://static.bearychat.com/FuuQLzPSAAoAcyMgtCQSivq7bOsa"
                                 class="img-rounded">
                            <h5>罗欣</h5>
                            <button class="btn btn-primary" id="luoxin">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://static.bearychat.com/FoIqziMoQtob74w3nXkJqrkJoKaQ"
                                 class="img-rounded">
                            <h5>赵春波</h5>
                            <button class="btn btn-primary" id="zhaochunbo">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://static.bearychat.com/FlnwTLw1lnsJh-RYRDPP4rXr5y2V"
                                 class="img-rounded">
                            <h5>王笑辉</h5>
                            <button class="btn btn-primary" id="wangxiaohui">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://static.bearychat.com/images/f2.png"
                                 class="img-rounded">
                            <h5>汪维冕</h5>
                            <button class="btn btn-primary" id="wangxiaohui">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://static.bearychat.com/FqLsIth0h6Ht2JSyjOTUfl1WZTSU"
                                 class="img-rounded">
                            <h5>徐亮</h5>
                            <button class="btn btn-primary" id="xuliang">报名</button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="thumbnail">
                            <img src="https://static.bearychat.com/FkULByhSycEqr3bHkBMp9wUm0Hsy"
                                 class="img-rounded">
                            <h5>苗伊凡</h5>
                            <button class="btn btn-primary" id="miaoyifan">报名</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="dynamic" class="col-xs-6 col-md-3 panel panel-default pull-right">
            <div class="panel-heading">总人数：<strong id="sum">0</strong></div>
            <ul class="list-group">
            </ul>
        </div>

    </div>
</div>
<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://cdn.wilddog.com/sdk/js/2.5.2/wilddog.js"></script>
<script>
    $(document).ready(function () {
        var config = {
            authDomain: "eat-17chuang.wilddog.com",
            syncURL: "https://eat-17chuang.wilddogio.com"
        };
        wilddog.initializeApp(config);
        var ref = wilddog.sync().ref("eat");

        var date = new Date();
        var dateChild = date.getFullYear() + '-' + date.getMonth() + '-' + date.getDate();
        ref.child(dateChild).once("value").then(function (snapshot) {
            if (!snapshot.exists()) {
                ref.child(dateChild).set({
                    "dengyongbin":false,
                    "kexian":false,
                    "mashiyu":false,
                    "lijiashuai":false,
                    "sunxuan":false,
                    "liuwei":false,
                    "wanggang":false,
                    "dengjiebin":false,
                    "huxiaojing":false,
                    "zhengxiaoqing":false,
                    "ruanyundong":false,
                    "zhangxiaojia":false,
                    "wangweimian": false,
                    "tiaoxingma": false,
                    "luoxin": false,
                    "wangxiaohui":false,
                    "zhaochunbo":false,
                    "wangweimian":false,
                    "xuliang":false,
                    "miaoyifan";false
                });
            }
        });

        ref.child(dateChild).limitToFirst(21).on("child_added",function(snapshot){
            makeData(snapshot, true);
        });

        ref.child(dateChild).on('child_changed', function(snapshot, error) {
            makeData(snapshot, false);
        });

        $("button").click(function () {
            ref.child(dateChild).child($(this).attr('id')).set($(this).text() == '报名' ? true : false);
        });
    });

    function makeData(snapshot, init) {
        var button = $('#' + snapshot.key());
        if (snapshot.val()) {
            button.text('已报名');
            button.addClass('btn-success');
            $('#sum').text(parseInt($('#sum').text()) + 1);
            $('.list-group').append('<li class="list-group-item"><span class="name">' + button.prev('h5').text() + '</span>报名了' + '</li>');
            $('#select').removeClass('hide');
            $('#select').prepend(button.parent().parent());
        } else {
            button.text('报名');
            if (!init) {
                $('#person').prepend(button.parent().parent());
                if ($('#select').children().length == 0) {
                    $('#select').addClass('hide');
                }
                button.removeClass('btn-success');
                $('#sum').text(parseInt($('#sum').text()) - 1);
                $('.list-group').append('<li class="list-group-item"><span class="name">' + button.prev('h5').text() + '</span>取消报名了' + '</li>');
            }
        }
    }
</script>
</body>
</html>
